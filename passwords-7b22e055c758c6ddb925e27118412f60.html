<html id="html">
  <head>
    <title id='title'>password generator</title>
    <meta name="viewport" content="user-scalable=no,width=device-width"/>
    <style>
    div.hidden {
    display: none;
}

body {
     background-color: #ddd;
     color: #222;
     font-family: Helvetica;
     font-size: 14px;
     margin: 0;
     padding: 0;
}

ul {
   list-style: none;
   margin: 10px;
   padding: 0;
}

html.small div#advanced {
       display: none;
}

html.small div#README {
	   display: none;
}
    </style>
    <script type="text/javascript">
    var md5=(function() {
/*
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2-beta Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */

/*
 * Configurable variables. You may need to tweak these to be compatible with
 * the server-side, but the defaults work in most cases.
 */
var hexcase = 0;   /* hex output format. 0 - lowercase; 1 - uppercase        */
var b64pad  = "";  /* base-64 pad character. "=" for strict RFC compliance   */

/*
 * These are the functions you'll usually want to call
 * They take string arguments and return either hex or base-64 encoded strings
 */
function hex_md5(s)    { return rstr2hex(rstr_md5(str2rstr_utf8(s))); }
function b64_md5(s)    { return rstr2b64(rstr_md5(str2rstr_utf8(s))); }
function any_md5(s, e) { return rstr2any(rstr_md5(str2rstr_utf8(s)), e); }
function hex_hmac_md5(k, d)
  { return rstr2hex(rstr_hmac_md5(str2rstr_utf8(k), str2rstr_utf8(d))); }
function b64_hmac_md5(k, d)
  { return rstr2b64(rstr_hmac_md5(str2rstr_utf8(k), str2rstr_utf8(d))); }
function any_hmac_md5(k, d, e)
  { return rstr2any(rstr_hmac_md5(str2rstr_utf8(k), str2rstr_utf8(d)), e); }

/*
 * Perform a simple self-test to see if the VM is working
 */
function md5_vm_test()
{
  return hex_md5("abc").toLowerCase() == "900150983cd24fb0d6963f7d28e17f72";
}

/*
 * Calculate the MD5 of a raw string
 */
function rstr_md5(s)
{
  return binl2rstr(binl_md5(rstr2binl(s), s.length * 8));
}

/*
 * Calculate the HMAC-MD5, of a key and some data (raw strings)
 */
function rstr_hmac_md5(key, data)
{
  var bkey = rstr2binl(key);
  if(bkey.length > 16) bkey = binl_md5(bkey, key.length * 8);

  var ipad = Array(16), opad = Array(16);
  for(var i = 0; i < 16; i++)
  {
    ipad[i] = bkey[i] ^ 0x36363636;
    opad[i] = bkey[i] ^ 0x5C5C5C5C;
  }

  var hash = binl_md5(ipad.concat(rstr2binl(data)), 512 + data.length * 8);
  return binl2rstr(binl_md5(opad.concat(hash), 512 + 128));
}

/*
 * Convert a raw string to a hex string
 */
function rstr2hex(input)
{
  try { hexcase } catch(e) { hexcase=0; }
  var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
  var output = "";
  var x;
  for(var i = 0; i < input.length; i++)
  {
    x = input.charCodeAt(i);
    output += hex_tab.charAt((x >>> 4) & 0x0F)
	   +  hex_tab.charAt( x        & 0x0F);
  }
  return output;
}

/*
 * Convert a raw string to a base-64 string
 */
function rstr2b64(input)
{
  try { b64pad } catch(e) { b64pad=''; }
  var tab = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
  var output = "";
  var len = input.length;
  for(var i = 0; i < len; i += 3)
  {
    var triplet = (input.charCodeAt(i) << 16)
		| (i + 1 < len ? input.charCodeAt(i+1) << 8 : 0)
		| (i + 2 < len ? input.charCodeAt(i+2)      : 0);
    for(var j = 0; j < 4; j++)
    {
      if(i * 8 + j * 6 > input.length * 8) output += b64pad;
      else output += tab.charAt((triplet >>> 6*(3-j)) & 0x3F);
    }
  }
  return output;
}

/*
 * Convert a raw string to an arbitrary string encoding
 */
function rstr2any(input, encoding)
{
  var divisor = encoding.length;
  var i, j, q, x, quotient;

  /* Convert to an array of 16-bit big-endian values, forming the dividend */
  var dividend = Array(Math.ceil(input.length / 2));
  for(i = 0; i < dividend.length; i++)
  {
    dividend[i] = (input.charCodeAt(i * 2) << 8) | input.charCodeAt(i * 2 + 1);
  }

  /*
   * Repeatedly perform a long division. The binary array forms the dividend,
   * the length of the encoding is the divisor. Once computed, the quotient
   * forms the dividend for the next step. All remainders are stored for later
   * use.
   */
  var full_length = Math.ceil(input.length * 8 /
				    (Math.log(encoding.length) / Math.log(2)));
  var remainders = Array(full_length);
  for(j = 0; j < full_length; j++)
  {
    quotient = Array();
    x = 0;
    for(i = 0; i < dividend.length; i++)
    {
      x = (x << 16) + dividend[i];
      q = Math.floor(x / divisor);
      x -= q * divisor;
      if(quotient.length > 0 || q > 0)
	quotient[quotient.length] = q;
    }
    remainders[j] = x;
    dividend = quotient;
  }

  /* Convert the remainders to the output string */
  var output = "";
  for(i = remainders.length - 1; i >= 0; i--)
    output += encoding.charAt(remainders[i]);

  return output;
}

/*
 * Encode a string as utf-8.
 * For efficiency, this assumes the input is valid utf-16.
 */
function str2rstr_utf8(input)
{
  var output = "";
  var i = -1;
  var x, y;

  while(++i < input.length)
  {
    /* Decode utf-16 surrogate pairs */
    x = input.charCodeAt(i);
    y = i + 1 < input.length ? input.charCodeAt(i + 1) : 0;
    if(0xD800 <= x && x <= 0xDBFF && 0xDC00 <= y && y <= 0xDFFF)
    {
      x = 0x10000 + ((x & 0x03FF) << 10) + (y & 0x03FF);
      i++;
    }

    /* Encode output as utf-8 */
    if(x <= 0x7F)
      output += String.fromCharCode(x);
    else if(x <= 0x7FF)
      output += String.fromCharCode(0xC0 | ((x >>> 6 ) & 0x1F),
				    0x80 | ( x         & 0x3F));
    else if(x <= 0xFFFF)
      output += String.fromCharCode(0xE0 | ((x >>> 12) & 0x0F),
				    0x80 | ((x >>> 6 ) & 0x3F),
				    0x80 | ( x         & 0x3F));
    else if(x <= 0x1FFFFF)
      output += String.fromCharCode(0xF0 | ((x >>> 18) & 0x07),
				    0x80 | ((x >>> 12) & 0x3F),
				    0x80 | ((x >>> 6 ) & 0x3F),
				    0x80 | ( x         & 0x3F));
  }
  return output;
}

/*
 * Encode a string as utf-16
 */
function str2rstr_utf16le(input)
{
  var output = "";
  for(var i = 0; i < input.length; i++)
    output += String.fromCharCode( input.charCodeAt(i)        & 0xFF,
				  (input.charCodeAt(i) >>> 8) & 0xFF);
  return output;
}

function str2rstr_utf16be(input)
{
  var output = "";
  for(var i = 0; i < input.length; i++)
    output += String.fromCharCode((input.charCodeAt(i) >>> 8) & 0xFF,
				   input.charCodeAt(i)        & 0xFF);
  return output;
}

/*
 * Convert a raw string to an array of little-endian words
 * Characters >255 have their high-byte silently ignored.
 */
function rstr2binl(input)
{
  var output = Array(input.length >> 2);
  for(var i = 0; i < output.length; i++)
    output[i] = 0;
  for(var i = 0; i < input.length * 8; i += 8)
    output[i>>5] |= (input.charCodeAt(i / 8) & 0xFF) << (i%32);
  return output;
}

/*
 * Convert an array of little-endian words to a string
 */
function binl2rstr(input)
{
  var output = "";
  for(var i = 0; i < input.length * 32; i += 8)
    output += String.fromCharCode((input[i>>5] >>> (i % 32)) & 0xFF);
  return output;
}

/*
 * Calculate the MD5 of an array of little-endian words, and a bit length.
 */
function binl_md5(x, len)
{
  /* append padding */
  x[len >> 5] |= 0x80 << ((len) % 32);
  x[(((len + 64) >>> 9) << 4) + 14] = len;

  var a =  1732584193;
  var b = -271733879;
  var c = -1732584194;
  var d =  271733878;

  for(var i = 0; i < x.length; i += 16)
  {
    var olda = a;
    var oldb = b;
    var oldc = c;
    var oldd = d;

    a = md5_ff(a, b, c, d, x[i+ 0], 7 , -680876936);
    d = md5_ff(d, a, b, c, x[i+ 1], 12, -389564586);
    c = md5_ff(c, d, a, b, x[i+ 2], 17,  606105819);
    b = md5_ff(b, c, d, a, x[i+ 3], 22, -1044525330);
    a = md5_ff(a, b, c, d, x[i+ 4], 7 , -176418897);
    d = md5_ff(d, a, b, c, x[i+ 5], 12,  1200080426);
    c = md5_ff(c, d, a, b, x[i+ 6], 17, -1473231341);
    b = md5_ff(b, c, d, a, x[i+ 7], 22, -45705983);
    a = md5_ff(a, b, c, d, x[i+ 8], 7 ,  1770035416);
    d = md5_ff(d, a, b, c, x[i+ 9], 12, -1958414417);
    c = md5_ff(c, d, a, b, x[i+10], 17, -42063);
    b = md5_ff(b, c, d, a, x[i+11], 22, -1990404162);
    a = md5_ff(a, b, c, d, x[i+12], 7 ,  1804603682);
    d = md5_ff(d, a, b, c, x[i+13], 12, -40341101);
    c = md5_ff(c, d, a, b, x[i+14], 17, -1502002290);
    b = md5_ff(b, c, d, a, x[i+15], 22,  1236535329);

    a = md5_gg(a, b, c, d, x[i+ 1], 5 , -165796510);
    d = md5_gg(d, a, b, c, x[i+ 6], 9 , -1069501632);
    c = md5_gg(c, d, a, b, x[i+11], 14,  643717713);
    b = md5_gg(b, c, d, a, x[i+ 0], 20, -373897302);
    a = md5_gg(a, b, c, d, x[i+ 5], 5 , -701558691);
    d = md5_gg(d, a, b, c, x[i+10], 9 ,  38016083);
    c = md5_gg(c, d, a, b, x[i+15], 14, -660478335);
    b = md5_gg(b, c, d, a, x[i+ 4], 20, -405537848);
    a = md5_gg(a, b, c, d, x[i+ 9], 5 ,  568446438);
    d = md5_gg(d, a, b, c, x[i+14], 9 , -1019803690);
    c = md5_gg(c, d, a, b, x[i+ 3], 14, -187363961);
    b = md5_gg(b, c, d, a, x[i+ 8], 20,  1163531501);
    a = md5_gg(a, b, c, d, x[i+13], 5 , -1444681467);
    d = md5_gg(d, a, b, c, x[i+ 2], 9 , -51403784);
    c = md5_gg(c, d, a, b, x[i+ 7], 14,  1735328473);
    b = md5_gg(b, c, d, a, x[i+12], 20, -1926607734);

    a = md5_hh(a, b, c, d, x[i+ 5], 4 , -378558);
    d = md5_hh(d, a, b, c, x[i+ 8], 11, -2022574463);
    c = md5_hh(c, d, a, b, x[i+11], 16,  1839030562);
    b = md5_hh(b, c, d, a, x[i+14], 23, -35309556);
    a = md5_hh(a, b, c, d, x[i+ 1], 4 , -1530992060);
    d = md5_hh(d, a, b, c, x[i+ 4], 11,  1272893353);
    c = md5_hh(c, d, a, b, x[i+ 7], 16, -155497632);
    b = md5_hh(b, c, d, a, x[i+10], 23, -1094730640);
    a = md5_hh(a, b, c, d, x[i+13], 4 ,  681279174);
    d = md5_hh(d, a, b, c, x[i+ 0], 11, -358537222);
    c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);
    b = md5_hh(b, c, d, a, x[i+ 6], 23,  76029189);
    a = md5_hh(a, b, c, d, x[i+ 9], 4 , -640364487);
    d = md5_hh(d, a, b, c, x[i+12], 11, -421815835);
    c = md5_hh(c, d, a, b, x[i+15], 16,  530742520);
    b = md5_hh(b, c, d, a, x[i+ 2], 23, -995338651);

    a = md5_ii(a, b, c, d, x[i+ 0], 6 , -198630844);
    d = md5_ii(d, a, b, c, x[i+ 7], 10,  1126891415);
    c = md5_ii(c, d, a, b, x[i+14], 15, -1416354905);
    b = md5_ii(b, c, d, a, x[i+ 5], 21, -57434055);
    a = md5_ii(a, b, c, d, x[i+12], 6 ,  1700485571);
    d = md5_ii(d, a, b, c, x[i+ 3], 10, -1894986606);
    c = md5_ii(c, d, a, b, x[i+10], 15, -1051523);
    b = md5_ii(b, c, d, a, x[i+ 1], 21, -2054922799);
    a = md5_ii(a, b, c, d, x[i+ 8], 6 ,  1873313359);
    d = md5_ii(d, a, b, c, x[i+15], 10, -30611744);
    c = md5_ii(c, d, a, b, x[i+ 6], 15, -1560198380);
    b = md5_ii(b, c, d, a, x[i+13], 21,  1309151649);
    a = md5_ii(a, b, c, d, x[i+ 4], 6 , -145523070);
    d = md5_ii(d, a, b, c, x[i+11], 10, -1120210379);
    c = md5_ii(c, d, a, b, x[i+ 2], 15,  718787259);
    b = md5_ii(b, c, d, a, x[i+ 9], 21, -343485551);

    a = safe_add(a, olda);
    b = safe_add(b, oldb);
    c = safe_add(c, oldc);
    d = safe_add(d, oldd);
  }
  return Array(a, b, c, d);
}

/*
 * These functions implement the four basic operations the algorithm uses.
 */
function md5_cmn(q, a, b, x, s, t)
{
  return safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b);
}
function md5_ff(a, b, c, d, x, s, t)
{
  return md5_cmn((b & c) | ((~b) & d), a, b, x, s, t);
}
function md5_gg(a, b, c, d, x, s, t)
{
  return md5_cmn((b & d) | (c & (~d)), a, b, x, s, t);
}
function md5_hh(a, b, c, d, x, s, t)
{
  return md5_cmn(b ^ c ^ d, a, b, x, s, t);
}
function md5_ii(a, b, c, d, x, s, t)
{
  return md5_cmn(c ^ (b | (~d)), a, b, x, s, t);
}

/*
 * Add integers, wrapping at 2^32. This uses 16-bit operations internally
 * to work around bugs in some JS interpreters.
 */
function safe_add(x, y)
{
  var lsw = (x & 0xFFFF) + (y & 0xFFFF);
  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
  return (msw << 16) | (lsw & 0xFFFF);
}

/*
 * Bitwise rotate a 32-bit number to the left.
 */
function bit_rol(num, cnt)
{
  return (num << cnt) | (num >>> (32 - cnt));
}

return {
  hex_md5: hex_md5
};

 })();
    //
// (C) Copyright Jon Seymour 2011
//

//
// A Binding is an object that exports a read and update function.
//
// The read function is used to read the view into the model.
// The update function is used to update the view with the model.
//
// The model and view are both represented by accessor functions.
//
// If the types of the view and model are different, an adapter
// is applied. The modelAdapter adapts values of the model's type
// to the view's type. The viewAdapter adapts values of the view's type
// to the model's type.
//
// INPUT_VALUE
//   Creates a binding between the value of an view input element and
//   the model.
// INTEGER
//   a bidirectional binding between the value of the view and the model,
//   such model stores and integer and the view stores a string.
// INPUT_TYPE
//   a read-only mapping between the type field of an input element and
//   the model
// INPUT_CHECKED
//   a mapping between the type field of an input element and the checked
//   element
// READONLY
//


//
//  Optimise the read function is adapted read if the adapter is the IDENTITY_MAP, and the read function is ADAPTED_READ.
//
Binding.OPTIMIZE_READ = function(read, adapter)
{
  if (adapter == Binding.IDENTITY_MAP && read == Binding.ADAPTED_READ) {
    return Binding.DIRECT_READ;
  } else {
    return read;
  }
};

//
// Optimise the update function, if the update function is ADAPTED_UPDATE and the adapter is IDENTITY_MAP
//
Binding.OPTIMIZE_UPDATE = function(update, adapter)
{
  if (adapter == Binding.IDENTITY_MAP && this.update == Binding.ADAPTED_UPDATE) {
    return Binding.DIRECT_UPDATE;
  } else {
    return update;
  }
};

//
// If the input is a function, the output is that function.
// Otherwise, the output is a function which uses the input object as a map.
//
Binding.AS_MAP = function(obj)
{
  if (typeof obj == 'function') {
    return obj;
  } else {
    return function(arg) {
      return obj[arg];
    };
  }
};

//
// A function that returns the argument as the result.
//
Binding.IDENTITY_MAP = function(arg) {
  return arg;
};

//
// A function that does nothing and has an undefined result.
//
Binding.NOOP = function() { };

//
// A read function that directly updates the model with the view.
//
Binding.DIRECT_READ = function() {
  this.model(this.view());
};

//
// A read function that updates the model after applying the
// view adapter to the view.
//
Binding.ADAPTED_READ = function() {
  this.model(this.viewAdapter(this.view()));
};

//
// An update function that directly updates the view with the model.
//
Binding.DIRECT_UPDATE = function() {
  this.view(this.model());
};

//
// An update function that updates the view with the result of applying
// the model adapter to the model.
//
Binding.ADAPTED_UPDATE = function() {
  this.view(this.modelAdapter(this.model()));
};

//
// An adapter that converts the input to the result
// of applying toString on the input or '' otherwise.
//
Binding.TO_STRING = function(arg) {
  return typeof arg == 'undefined' ? '' : arg.toString();
};

//
// Creates a simple binding between the value of the view and the model.
//
Binding.INPUT_VALUE=function(config) {
  return new Binding(config,
  {
    onblur: function() {
      this.read();
      return true;
    }
  })
};

Binding.ACTION=function(config) {
  return new Binding(config,
  {
    read: Binding.NOOP,
    update: Binding.NOOP,
    onclick: function() {
      this.model();
      return true;
    }
  });
};

//
// Creates a binding that updates the view, but not the model.
//
Binding.READONLY=function(config) {
  return new Binding(config, { read: Binding.NOOP } );
};

//
// Creats a binding that stores an integer in the model and a string in the view
//
Binding.INTEGER=function(config) {

  return new Binding(config, {
    viewAdapter: parseInt,
    modelAdapter: Binding.TO_STRING,
    onblur: function() {
      this.read();
      return true;
    }
  });
};

//
// Creates a binding that binds the model to the type selector of a form input.
//
Binding.INPUT_TYPE=function(config) {
  return new Binding(config, {
    read: Binding.NOOP,
    update: function() {
      this.view.input.type = this.modelAdapter(this.model());
    }
  });
};

//
// Creates a binding that binds the model to the checked property of a checkbox input.
//
Binding.INPUT_CHECKED=function(config) {
  return new Binding(config, {
    read: function() {
      this.model(this.viewAdapter(this.view.input.checked));
    },
    update: function() {
      this.view.input.checked = this.modelAdapter(this.model());
    },
    onchange: function() {
      this.read();
      return true;
    }
  });
};

//
// Creates a read-only binding that binds the model to the
// innerHTML property of a view element.
//
Binding.INNER_HTML=function(config)
{
  return new Binding(config, {
    read: Binding.NOOP,
    update: function() {
	try {
	    this.view.element.innerHTML = this.modelAdapter(this.model());
	} catch (x) {
	    console.error("failed to apply update:"+x);
	    console.dir(x);
	    console.dir(this);
	}
    }
  });
};

//
// Creates a read-only binding that binds the model to the
// innerHTML property of a view element.
//
Binding.CLASS=function(config)
{
  return new Binding(config, {
    read: Binding.NOOP,
    update: function() {
	try {
	    var name=this.modelAdapter(this.model());
	    if (name) {
		this.view.element.className = name;
	    }
	} catch (x) {
	    console.error("failed to apply update:"+x);
	    console.dir(x);
	    console.dir(this);
	}
    }
  });
};

Binding.ATTRIBUTE=function(config)
{
  return new Binding(config, {
    read: Binding.NOOP,
    update: function() {
	if (config.attribute) {
	    this.view.element.setAttribute(config.attribute, this.modelAdapter(this.model()));
	}
	return;
    }
  });
};

Binding.MULTI=function(bindings)
{
    return new Binding
    (
	{
	    read: function() {
		var b;
		for (b in bindings) {
		    bindings[b].read();
		}
	    },
	    update: function() {
		var b;
		for (b in bindings) {
		    bindings[b].update();
		}
	    }
	}
    );
};

Binding.QUERY=function() {
    return new Binding
    (
	{
	    modelAdapter: Binding.QUERY.ENCODER,
	    viewAdapter: Binding.QUERY.DECODER,
	    read: function(arg) {
	      if (arg || this.auto) {
		this.model(this.viewAdapter(location.search));
	      }
	    },
	    update: function(arg) {
	      if (arg || this.auto) {
		var tmp = location.href.split('?')[0] + this.modelAdapter(this.model());
		location.replace(tmp);
	      }
	    },
	    auto: false
	}
    );
};

Binding.QUERY.DECODER=function(query) {
  var
  i,
  pairs=query.substring(1).split('&'),
  result = {},
  name,
  value,
  pair;

  if (pairs != '') {
    for (i in pairs) {
      pair=pairs[i];
      i=pair.indexOf('=');

      if (i>=0) {
	name = decodeURIComponent(pair.substring(0, i));
	value = decodeURIComponent(pair.substring(i+1));
      } else {
	name = decodeURIComponent(pair);
	value = '';
      }
      result[name] = value;
    }
  }
  return result;
};

Binding.QUERY.ENCODER = function(map) {
    var
    search='?',
    name;
    for (name in map) {
	if (search != '?') {
	    search = search + "&";
	}
	search += encodeURIComponent(name) + '=' + encodeURIComponent(map[name] || '');
    }
    return search;
};

//
// Creates a new binding with a read and update function.
//
// If the config doesn't specify any defaults, the specified
// defaults are used instead.
//
function Binding(config, defaults)
{
  // replace array with multi binding.
  var m;

  if (!config) {
    config = {};
  }

  if (defaults) {
    for (m in defaults) {
      if (!config[m]) {
	config[m] = defaults[m];
      }
    }
  }

  if (config instanceof Binding) {
    return config;
  }

  for (m in config) {
    if (config.hasOwnProperty(m)) {
      this[m] = config[m];
    }
  }

  //
  // turn non-functions into map functions, using Binding.AS_MAP
  //

  this.viewAdapter = Binding.AS_MAP(this.viewAdapter);
  this.modelAdapter = Binding.AS_MAP(this.modelAdapter);

  // optimise the bindings if adaption is not required.

  this.read = Binding.OPTIMIZE_READ(this.read, this.viewAdapter);
  this.update = Binding.OPTIMIZE_UPDATE(this.update, this.modelAdapter);

  return this;
}

Binding.prototype.model = Binding.NOOP;
Binding.prototype.view = Binding.NOOP;
Binding.prototype.controller = {};
Binding.prototype.modelAdapter = Binding.IDENTITY_MAP;
Binding.prototype.viewAdapter = Binding.IDENTITY_MAP;
Binding.prototype.read = Binding.ADAPTED_READ;
Binding.prototype.update = Binding.ADAPTED_UPDATE;

//
// Configure the model and view accessor functions for a binding.
//
Binding.prototype.bind=function(model, view, controller)
{
    var h,hook,hooks;

    this.model = model;
    this.view = view;
    this.controller = controller;

    if (this.view && typeof this.view.hooks == 'function') {
	hooks = this.view.hooks();
	for (h in hooks) {
	    hook=hooks[h];
	    if (this[h]) {
		hook(h, this, this[h]);
	    }
	}
    }
};
    Accessor.NOOP = function() {};

function Accessor(target, props)
{
  target = (target && props) ? target : this;

  var result = function() {
    if (arguments.length > 0) {
      return target.set.apply(result, arguments);
    } else {
      return target.get.apply(result);
    }
  };

  if (props) {
    for (p in props) {
      result[p] = props[p];
    }
  }
  result.defaultBinding = target.defaultBinding;
  result.hooks = target.hooks;

  return result;
}

Accessor.prototype.get = Accessor.NOOP;
Accessor.prototype.set = Accessor.NOOP;
Accessor.prototype.defaultBinding = function() {
  throw new Error("no binding defined for accessor");
};

function InputAccessor(input)
{
  return Accessor(this, { 'input': input } );
}

InputAccessor.prototype.get=function() {
  return this.input.value;
};

InputAccessor.prototype.set= function(arg) {
  this.input.value = arg;
  return undefined;
};

InputAccessor.HOOKS = {};
InputAccessor.HOOKS.hook=function(name, binding, impl)
{
    binding.view.input[name] = binding.controller.intercept(
	function () {
	    return impl.apply(binding);
	}
    );
};

InputAccessor.HOOKS.ACTION={
  onclick: InputAccessor.HOOKS.hook
};
InputAccessor.HOOKS.DATA={
  onblur: InputAccessor.HOOKS.hook,
  onfocus: InputAccessor.HOOKS.hook
};

InputAccessor.HOOKS.FAST_DATA={
  onchange: InputAccessor.HOOKS.hook,
};

InputAccessor.HOOKS.button=InputAccessor.HOOKS.ACTION;
InputAccessor.HOOKS.submit=InputAccessor.HOOKS.ACTION;
InputAccessor.HOOKS.checkbox=InputAccessor.HOOKS.FAST_DATA;

InputAccessor.prototype.hooks = function()
{
    var hooks = InputAccessor.HOOKS[this.input.type];
    if (hooks) {
	return hooks;
    } else {
	return InputAccessor.HOOKS.DATA;
    }
};

InputAccessor.DEFAULT_BINDING = {};
InputAccessor.DEFAULT_BINDING.button=Binding.ACTION;
InputAccessor.DEFAULT_BINDING.submit=Binding.ACTION;
InputAccessor.DEFAULT_BINDING.checkbox=Binding.INPUT_CHECKED;

InputAccessor.prototype.defaultBinding = function() {
    var constructor = InputAccessor.DEFAULT_BINDING[this.input.type];
    if (constructor) {
	return constructor();
    } else {
	return Binding.INPUT_VALUE();
    }
};

function ElementAccessor(element)
{
  return Accessor(this, { 'element': element });
}

ElementAccessor.prototype.get = function() {
  return this.element.innerHTML;
};

ElementAccessor.prototype.set = function(arg) {
  this.element.innerHTML = arg ;
  return undefined;
};

ElementAccessor.prototype.defaultBinding = function() {
    return Binding.INNER_HTML();
};

function PropertyAccessor(obj, property)
{
  return Accessor(this, (obj && property) ? { 'object': obj, 'property' : property }  : undefined);
}

PropertyAccessor.prototype.get = function() {
  return this.object[this.property];
};

PropertyAccessor.prototype.set = function(value) {
  this.object[this.property] = value;
  return undefined;
};

function MultiAccessor(model, keys)
{
    return new Accessor
    (
	this,
	(model && keys) ? { 'model': model, 'keys': keys } : undefined
    );
}

MultiAccessor.prototype.get = function()
{
  var
    i,
    k,
    map = {};

  for (i in this.keys) {
    k=this.keys[i];
    map[k] = this.model[k]();
  }
  return map;
};

MultiAccessor.prototype.set = function(map)
{
  var i,k;
  for (i in this.keys) {
    k=this.keys[i];
    this.model[k](map[k]);
  }
  return;
};
    function Model(members)
{
    var
      api = this,
      impl = {},
      v,
      m;

    for (m in members)
    {
	v = members[m];
	if (typeof members[m] == 'function') {
	    api[m] = (function(v1) {
	      return function() {
		return v1.apply(api, arguments);
	      };
	    })(v);
	} else {
	    impl[m] = v;
	    api[m] = new PropertyAccessor(impl, m);
	}
    }
    return api;
}
    //
// Constructs a view.
//
function View(defs)
{
    var
	api = this,
	elt,
	def,
	form,
	f,
	m;

    for (m in defs) {
	def = defs[m];
	if (def.type == 'form') {
	    form = document.forms[def.id];
	    if (!form) {
		continue;
	    }
	    for (f in form.elements) {
		api[form.elements[f].name] = new InputAccessor(form.elements[f]);
	    }
	} else if (def.type == 'element') {
	  elt = document.getElementById(def.id);
	  api[m] = new ElementAccessor(elt);
	} else {
	  elt = document.getElementById(m);
	  api[m] = new ElementAccessor(elt);
	}
    }
    return api;
}
    function Controller(config)
{
    this.loader = function(f) {
	var
	controller = this;

	return function() {
	    var proceed;

	    try {

		controller.model = new Model(config.model);
		controller.view = new View(config.view);
		controller.bind(config.bindings);

		if (typeof f == 'function') {
		    proceed = f.apply(controller);
		}

		if (proceed) {
		    controller.update();
		}

	    } catch (x) {
		window.alert(x.lineNumber + ': ' + x);
		throw x;
	    }
	    return;
	};
    };
}

Controller.prototype.view = {};

Controller.prototype.model = {};

Controller.prototype.bindings = {};

Controller.prototype.read = function() {
    var b;

    for (b in this.bindings) {
	this.bindings[b].read.apply(this.bindings[b], arguments);
    }
};

Controller.prototype.update = function() {
    var b;

    for (b in this.bindings) {
	this.bindings[b].update.apply(this.bindings[b], arguments);
    }

    return;
};

Controller.prototype.bind = function(config) {
  var
    model=this.model,
    view=this.view,
    controller=this,
    m, // model accessor
    n, // view name
    v, // view accessor
    b, // binding
    configure, // configuration function for binding
    bb,
    t;

    this.bindings = {};

    for (n in view) {
	v = view[n];
	if (!config[n]) {
	    b = v.defaultBinding();
	    this.bindings[n] = b;
	    m = model[n];
	    if (!m) {
		continue;
	    }
	    b.bind(m,v,controller);
	}
    }

    configure = function(name, binding) {
	var m,v;

	if (typeof binding.model != 'function') {
	    if (binding.model instanceof Array) {
		m = new MultiAccessor(model, binding.model);
	    } else {
		m = model[binding.model];
	    }
	} else {
	    m = model[name];
	}
	m = m || new Accessor();
	v = view[name];
	binding.bind(m,v, controller);
	return binding;
    };


    for (n in config) {
	b = config[n];
	if (b instanceof Array) {
	    bb = [];
	    for (b in config[n]) {
		bb.push(configure(n, (config[n])[b]));
	    }
	    b = Binding.MULTI(bb);
	} else {
	    configure(n, b);
	}
	this.bindings[n] = b;
    }

    return;
};

Controller.prototype.intercept = function(f)
{
    var self=this;
    return function() {
	try {
	    return f.apply(this);
	} catch (x) {
	    window.alert(x.lineNumber + ': ' + x);
	    throw x;
	} finally {
	    self.update();
	}
    };
};
    mvc={
  "Model": Model,
  "View": View,
  "Controller": Controller,
  "Binding": Binding
};
    loader =
(function() {
    var
    timer,
    params = {
      "host": '',
      "user": '',
      "initial_template": '',
      "next_template": ''
    },
    config = {
	view:
	{
	    "form": { type: 'form', id: 'generator' },
	    "html": {},
	    "message": {},
	    "count": {},
	    "title": {},
	    "confirmed": {},
	    "bookmark": {}
	},
	model:
	{
	    'maxseekcount': 1024,
	    'count': 0,
	    'search': '',
	    'output': '',
	    'message': '',
	    'host': '',
	    'user': '',
	    'initial_template': '${user}:${secret}@${host}${salt}',
	    'next_template': '${output}${secret}${salt}',
	    'salt': '',
	    'secret': '',
	    "confirm": '',
	    'show': false,
	    'auto': true,
	    'advanced': false,
	    'location': params,
	    'seek': function() {
		if (this.count() >= this.maxseekcount()) {
		    this.message("to go further, adjust max count");
		} else {
		    while (this.count() < this.maxseekcount() && (this.output() != this.search() || this.search() == '') ) {
			this.cycle();
		    }
		}
	    },
	    "next": function() {
		this.cycle();
	    },
	    "cycle": function() {
		var template =
		    (this.output()=='')
		    ? this.initial_template()
		    : this.next_template();
		var tmp;

		if (this.output()!='') {
		    tmp=this.next_template().replace('\${secret}', this.secret());
		    tmp=tmp.replace('\${output}', this.output());
		} else {
		    tmp=this.initial_template().replace('\${secret}', this.secret());
		}

		tmp=tmp.replace('\${user}', this.user());
		tmp=tmp.replace('\${salt}', this.salt());
		tmp=tmp.replace('\${host}', this.host());

		this.output(md5.hex_md5(tmp+'\n').substring(0,8));
		this.count(this.count()+1);
	    },
	    "prev": function() {
		var limit=this.count() > 0 ? this.count()-1 : 0;
		this.count(0);
		this.output('');
		while (this.count() < limit) {
		    this.cycle();
		}
	    },
	    "clear_sensisitve": function() {
		var orig=this.secret()+this.confirm()+this.output()+this.search();
		this.output('');
		this.secret('');
		this.confirm('');
		this.search('');
		if (orig != '') {
		    this.message('sensitive values cleared by timeout');
		}
	    },
	    "confirmed": function() {
		if (arguments.length > 0) {
		    return '';
		}
		if (this.secret() == this.confirm()) {
		    return this.secret() == '' ? '' : 'ok';
		} else {
		    return 'not confirmed';
		}
	    },
	    "location": function(map) {
		var p;
		if (arguments.length == 0) {
		  var result = {};
		  for (p in params) {
		    result[p] = this[p]();
		  }
		  return result;
		} else {
		  for (p in params) {
		    if (map[p]) {
		      this[p](map[p]);
		    }
		  }
		  return undefined;
		}
	    },
	    "clear": function() {
		this.secret('');
		this.confirm('');
	    },
	    "reset": function() {
		this.output('');
		this.message('');
		this.search('');
		this.maxseekcount(1024);
		this.count(0);
	    },
	    "title": function() {
		var
		tmp="password generator",
		map={
		    user: this.user(),
		    host: this.host()
		};

		if (map.user != '') {
		  tmp = map.user;
		  if (map.host != '') {
		    tmp = tmp + "@";
		  }
		}
		if (map.host != '') {
		  if (map.user == '') {
		    tmp = tmp + ' ';
		  }
		  tmp = tmp + map.host;
		} else {
		  tmp = "password generator";
		}
		return tmp;
	    }
	},
	bindings:
	{
	    "maxseekcount": Binding.INTEGER(),
	    "location": Binding.QUERY(),
	    "bookmark": [
		Binding.ATTRIBUTE(
		{
		    attribute: "href",
		    model: "location",
		    modelAdapter: function(arg) {
			return location.href.split('?')[0]+Binding.QUERY.ENCODER(arg);
		    }
		}),
		Binding.INNER_HTML({model: "title"})
	    ],
	    "html": Binding.CLASS(
		{
		    modelAdapter: function(arg) {
			if (window.innerWidth && window.innerWidth <= 480) {
			    return "small";
			} else {
			    return "";
			}
		    }
		}),
	    "output": [
		Binding.INPUT_VALUE(),
		Binding.INPUT_TYPE(
		    {
			"model": "show",
			"modelAdapter":
			{
			    "true": "text",
			    "false": "password"
			}
		    })
	    ],
	    "go": Binding.ACTION(
		{
		    onclick: function() {
			this.controller.bindings.location.update(true);
		    }
		})
	}
    };

    return new mvc.Controller(config)
	 .loader(
	     function() {
		 this.bindings.location.read(true);
		 this.bindings.html.update(true);
		 return true;
	     });
})();
    window.onload=loader;
    </script>
  </head>
  <body>
    <form name="generator" onsubmit="javascript: return false;" id="generator">
  <div id="basic">
    <ul>
      <span id="message"></span>
      <li><input name="user" type="text" placeholder="user" autocorrect="off" autocapitalize="off"/></li>
      <li><input name="host" type="text" placeholder="host"  autocorrect="off" autocapitalize="off"/></li>
      <li><input name="secret" type="password" placeholder="secret"  autocorrect="off" autocapitalize="off"/>
        <input name="clear" value="clear" type="button" />
      </li>
      <li><input name="confirm" type="password" placeholder="confirm"  autocorrect="off" autocapitalize="off"/>
	<span id="confirmed">confirmed</span>
      </li>
      <li>
        <input name="output" type="password" placeholder="output"  autocorrect="off" autocapitalize="off"/>
        <input name="show" value="true" type="checkbox" />show
      </li>
      <li>
        <input name="next" value="next" type="button" /> &nbsp;
        <input name="prev" value="prev" type="button" />
        <input name="reset" value="reset" type="button" />
      </li>
      <li>
        <input name="go" value="go" type="button" />
        <a href="#" id="bookmark" name="bookmark"></a>
      </li>
    </ul>
  </div>

  <div id="advanced">
    <ul>

      <li>
        <input name="initial_template" size="64" type="text" placeholder="initial_template"  autocorrect="off" autocapitalize="off"/>
      </li>

      <li>
        <input name="next_template" type="text" placeholder="next_template"  autocorrect="off" autocapitalize="off"/>
      </li>

      <li>
        <input name="search" type="password" placeholder="search"  autocorrect="off" autocapitalize="off"/>
        <input name="seek" value="seek" type= "button" />
      </li>

      <li>
	<input name="maxseekcount" value="1" type="text" placeholder="max seek count"  autocorrect="off" autocapitalize="off"/>
      </li>

      <li>
        <span id="count" placeholder="count">0</span>
      </li>

      <li>
        <input name="salt" type="text" placeholder="salt"  autocorrect="off" autocapitalize="off"/>
      </li>

      <li>
	<input name="auto" type="checkbox" checked="checked" /><label for="auto">enabled</label>
      </li>
    </ul>
  </div>
</form>
    <div id="README">
    <hr/>
    <h1>NAME</h1>

<p>passwords.html - a password sequence generator</p>

<h1>DESCRIPTION</h1>

<p>passwords.html is a standalone HTML file that contains a password sequence generator.</p>

<p>Initial passwords are generated by substituting parameter values into the initial template, appending \n, calculating the MD5 hash of the resulting string. Templates are arbitrary strings which may optionally contain parameter reference markers. The supported parameters for the initial template are: user, host, salt, secret.</p>

<p>The output is the left-most 8 hex-digits of the resulting MD5 hash. This value maybe used as a password or as the component of a password.</p>

<p>The default initial template is: ${user}:${secret}@${host}${salt}.</p>

<p>To use the generator to generate an initial password, enter a user or account name in the user field, a host or domain name
in the host field and a secret in the secret field. Use the 2nd secret field to confirm the secret. Then hit next. To see
the generated password, check the "show" checkbox.</p>

<p>Subsequent passwords are generated in the same way, this time using the next template as the template.
The next template can reference the previously generated output using the ${output} parameter reference. </p>

<p>The default next template: is ${output}${secret}${salt}.</p>

<p>The page can be bookmarked to reduce the amount of typing you need to do the next time you need to generate (or re-generate) the password. 
Note that the generated bookmarks do include the salt but do not include any value derived from your secret, including the output.</p>

<h1>USAGE SCENARIOS</h1>

<h2>Site-Specific Passwords</h2>

<p>Instead of using the same password across multiple sites, generate a different password for each
site. Provided you keep your secret secure, compromise of one site's password database won't have
implications for accounts at other sites.</p>

<h2>Password Renewal</h2>

<p>Some sites force you to change your password periodically. It can be hard to remember a recently changed password but
you usually can remember the old password. If you assign passwords from the sequence, you can usually find
the current password simply by regenerating it.</p>

<h2>Password Recovery</h2>

<p>On test and development systems it is common practice to share the same password across multiple systems 
even though this may be against recommended best practice. However, unless all accounts are regularly accessed,
less frequently used accounts may still use an older password. If you assign passwords from a sequence
you may be able to recover the password from the sequence, even if you have actually forgotten what that password was.</p>

<h1>INSTALLATION</h1>

<ol>
<li>save https://github.com/jonseymour/passwords/raw/release/passwords.html to your local disk</li>
<li>verify that your copy of passwords.html matches the MD5 hash of a trusted version of this file as documented by https://github.com/jonseymour/passwords/raw/release/versions.txt</li>
<li>open the saved copy in your browser</li>
<li>optionally, modify the salt to some public, but arbitrary value</li>
<li>save the generated bookmark as a link </li>
</ol>

<h1>SECURITY CONSIDERATIONS</h1>

<p>The passwords generated by passwords.html may be secure provided:</p>

<ul>
<li>your secret is never compromised</li>
<li>you only download passwords.html from a trusted source</li>
<li>you store your copy of passwords.html on a secure file system</li>
<li>you regularly check that your copy of passwords.html has a trusted MD5 sum</li>
<li>you only use passwords.html in a trusted browser on trusted machine</li>
<li>you always use a secure transport</li>
<li>all your browser plugins and add-ons are trusted</li>
<li>your bookmark store is secure</li>
<li>your desktop's clipboard is secure</li>
</ul>

<p>If any of the above assumptions are not true, then your secret and generated passwords may be vulnerable to exposure.</p>

<p>In particular, man-in-the-middle attacks will be trivial if an attacker can do enough to convince
you to load a maliciously altered copy of this page.</p>

<p>Rainbow table attacks on the secret may be mitigated somewhat by salting the generation templates with a non-blank
${salt} parameter.</p>

<p>Since the generated passwords only contain 32 bits of entropy, rainbow table attacks on the generated output 
may be successful, unless you further salt the output with a small prefix or suffix prior to using the output
as a password on the end system. Future versions will allow you to configure this edit with an output template but
for now you can do this manually.</p>

<p>passwords.html will never write the secret, or anything derived from the secret including the generated output, into the browser history or a bookmark. 
However, passwords.html may leave evidence of its use, including the host names, userids and salts in the browser history. If this is a concern to 
you, consider restricting use of passwords.html to private browsing sessions by using your browser's private browsing feature.</p>

<h1>TRUST</h1>

<p>Should you trust this page to manage generated passwords securely? </p>

<p>Not automatically. If a miscreant can arrange to make you load a maliciously altered copy of this page, your secret
and your passwords will be vulnerable to exposure.</p>

<p>However, if the page you are reading has an MD5 hash listed in https://github.com/jonseymour/passwords/raw/release/versions.txt then
the claims listed in the section below should be true.</p>

<h1>CLAIMS</h1>

<p>These claims apply only to pages that have an MD5 hash listed in https://github.com/jonseymour/passwords/raw/release/versions.txt. Anyone technically competent to do so is invited to verify that these claims are, in fact, true.</p>

<p>Such a page:</p>

<ul>
<li>never transmits or stores any value directly or indirectly derived from the secret</li>
<li>never attempts to use the network for any purpose, including loading of resources such as scripts, CSS files or images</li>
<li>never attempts to misrepresent the target of dynamically generated links</li>
</ul>

<p>This version of passwords.html does not currently attempt to read or modify a user's cookies however this may not be true of all versions of passwords.html. Check the version
you are using to be sure.</p>

<h1>FILES</h1>

<ul>
<li>Latest version - https://github.com/jonseymour/passwords/raw/release/passwords.html</li>
<li>Latest version MD5 - https://github.com/jonseymour/passwords/raw/release/passwords.md5</li>
<li>Previous versions - https://github.com/jonseymour/passwords/raw/release/passwords-{MD5}.md5</li>
<li>Previous version MD5s - https://github.com/jonseymour/passwords/raw/release/versions.txt</li>
</ul>

<h1>WEB</h1>

<p>The home page for this project is https://github.com/jonseymour/passwords/</p>

<h1>GIT</h1>

<p>The git repo for this project is git://github.com/jonseymour/passwords.git</p>

<p>The following branches are maintained:</p>

<dl>
<dt>master</dt>
<dd>contains source only</dd>
<dt>release</dt>
<dd>contains source and build products</dd>
</dl>

<h1>AUTHOR</h1>

<p>Copyright (C) Jon Seymour 2011<br/>
MD5 implementation Copyright (C) Paul Johnston, et al. 1999 - 2009</p>

<h1>REVISIONS</h1>

<dl>
<dt>1.0.5</dt>
<dd>
<ul>
<li>fix generation of bookmark link</li>
<li>tune HTML for iPhone form factor</li>
</ul>
</dd>
<dt>1.0.4</dt>
<dd>Fix issues that prevented correct operation in Safari.</dd>
<dt>1.0.3</dt>
<dd>Refinements to reflect changes in MVC library.</dd>
<dt>1.0.2</dt>
<dd>Restored bookmark functionality</dd>
<dt>1.0.1</dt>
<dd>Refactored in terms of a lightweight MVC framework (see https://github.com/jonseymour/mvc).
</dd>
<dt>1.0</dt>
<dd>Initial release</dd>
</dl>

<p></dd></p>

<h1>ACKNOWLEDGEMENTS</h1>

<p>passwords.html makes use of Paul Johnson's JavaScript MD5 implementation - see http://pajhome.org.uk/crypt/md5 for more info</p>
    </div>
  </body>
</html>
